fileVersion: 1
id: 5591b680-04c9-418f-8a32-8c2ec725273e
name: V_INTERCEPTED_PERIODS_WITH_BREACH_FLAG
operation:
  config:
    OverrideSQLCreate: false
    groupByAll: false
    insertStrategy: UNION
    secureoption: false
    selectDistinct: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 013ae639-45da-4c5a-9ce0-10023d9fab7f
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: TICKET_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 44a88b53-e0a9-4224-bdfe-3ce31ccc1c78
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3eafdd1f-2844-46fd-9027-8fd39e4d93f0
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: TICKET_CREATED_AT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 02e9e6ec-0ec4-4a9f-83d9-7b3f6761eced
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9984a218-0af8-4094-b2cf-a94831173140
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: TIMESTAMP_TZ(9)
        description: ""
        name: VALID_STARTING_AT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3e76bcd0-80b0-4563-b1c6-75447a888ca8
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 669aeb53-3476-4ad5-8460-75526b158d9e
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: TICKET_CURRENT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 78b665bb-aa79-42f7-9c25-a3eab377ad2f
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ea7b13c-872a-4cab-9a2e-451b5984b77d
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: METRIC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 295bfff6-62eb-4951-9c23-5462b4887aac
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: de0f3dd5-da97-4574-806f-0082f2071100
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: LATEST_SLA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e767651a-4734-415b-89d3-8c556724f198
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 218a68b4-f5a8-4e83-90c5-774702f86fea
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: SLA_APPLIED_AT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 69f07738-2c9e-49a1-ae20-78de3590a6df
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d5e1f2dc-c54a-436e-9209-24ff77cb7821
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: TARGET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f9e89dab-8378-432d-a467-918a8a9dcec1
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 563a645c-8b64-4c3f-bfde-8de3a2084b4c
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: IN_BUSINESS_HOURS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3700cb12-7f81-42c0-a529-310993ecd2af
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 73c4f686-ad39-4f8b-91cb-ae10b538d69a
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: SLA_POLICY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 787f65eb-ac6b-45c3-8472-a2f669cad498
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 67fa4a26-5d1c-441a-b272-ad3df1cb1e8a
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: SCHEDULE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5bb4d491-1b7b-4cee-9b1a-79863e37411d
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f20ae48-9a23-4cac-93fa-dd2ea0406e1e
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: START_TIME_IN_MINUTES_FROM_WEEK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 439def97-ef3f-49f5-bf3c-829cf9d99e6b
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 96245770-efe6-47fd-9070-3f66be083814
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: TOTAL_SCHEDULE_WEEKLY_BUSINESS_MINUTES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 41d0d8f6-8c3b-43ed-a4cd-e8f9e47f33bd
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: daaba96a-23b0-4cac-8a85-a147a38ca121
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: START_WEEK_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 06866dc9-d061-40b6-9620-af9d3c2b6724
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f80a2d52-6160-4458-bea2-2c510feac261
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: FIRST_REPLY_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ebc3a5be-72b5-4109-a76d-a8bd170906c8
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b8e1e95f-d525-4dea-b12a-d257e0660acf
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: FIRST_SOLVED_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b3b5cef-85c5-40b9-97da-35268edc6e8f
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: df4936e4-121e-4709-8e5f-180336dccce6
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: WEEK_INDEX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c0d8d8d7-4331-470c-bf89-16a5180a407d
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a81005a5-24c8-433d-b29c-26a04284a8d3
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: WEEK_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9f7996ec-d551-432d-8180-2ea0d52ef278
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 26a02eb0-df64-4a8d-970f-0621f046478c
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: TICKET_WEEK_START_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3966eaef-abf1-46a3-a89c-ae6db1410972
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 98ed92af-e726-4cd5-bff4-62faed889ae6
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: TICKET_WEEK_END_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8f503ffd-f1d9-4eb1-95e4-4a43502ca64c
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b4697c05-fb41-4d68-8ff7-70c2ac1e7598
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: SCHEDULE_START_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e777d25c-60b7-458d-a74f-6291fc3585a0
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e319dfb6-9b57-49b7-9379-1f56f57666c8
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: SCHEDULE_END_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 78600115-6e55-4a11-a6a9-ce09b6a0ad32
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec43c594-7733-482a-ba23-1c8e2158aacb
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: LAPSED_BUSINESS_MINUTES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 22777722-422d-4d69-a1ae-b12e88b5ef35
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87382f69-837d-4061-9551-a1143bb221d9
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        description: ""
        name: SUM_LAPSED_BUSINESS_MINUTES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4eb2c768-3e4c-4615-b2f1-509927a99548
                stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 31811640-5c11-4be7-acb0-4d4b02cc30c3
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        defaultValue: ""
        description: ""
        name: REMAINING_MINUTES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: target - sum_lapsed_business_minutes
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 19731639-abac-4b40-a855-3b45b87661c5
          stepCounter: 5591b680-04c9-418f-8a32-8c2ec725273e
        config: {}
        dataType: ""
        defaultValue: ""
        description: ""
        name: IS_BREACHED_DURING_SCHEDULE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              case when (target - sum_lapsed_business_minutes) < 0 
                    and 
                      (lag(target - sum_lapsed_business_minutes) over
                      (partition by ticket_id, metric, sla_applied_at order by week_number, schedule_start_time) >= 0 
                      or 
                      lag(target - sum_lapsed_business_minutes) over
                      (partition by ticket_id, metric, sla_applied_at order by week_number, schedule_start_time) is null) 
                      then true else false end
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: V_INTERCEPTED_PERIODS_REPLY
        join:
          joinCondition: FROM {{ ref('TARGET', 'V_INTERCEPTED_PERIODS_REPLY') }} "V_INTERCEPTED_PERIODS_REPLY"
        name: V_INTERCEPTED_PERIODS_WITH_BREACH_FLAG
        noLinkRefs: []
  name: V_INTERCEPTED_PERIODS_WITH_BREACH_FLAG
  overrideSQL: false
  schema: ""
  sqlType: Base:::188
  type: sql
  version: 1
type: Node
