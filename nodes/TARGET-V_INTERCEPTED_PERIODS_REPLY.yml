fileVersion: 1
id: dc76a1bd-4962-4cc7-b286-dbce093916de
name: V_INTERCEPTED_PERIODS_REPLY
operation:
  config:
    OverrideSQLCreate: false
    groupByAll: false
    insertStrategy: UNION
    secureoption: false
    selectDistinct: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 44a88b53-e0a9-4224-bdfe-3ce31ccc1c78
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: TICKET_ID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 364ddf9e-65e9-407e-8983-b3500484a455
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 02e9e6ec-0ec4-4a9f-83d9-7b3f6761eced
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: TICKET_CREATED_AT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d51024ca-fad3-420c-8871-9f4d838766a6
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e76bcd0-80b0-4563-b1c6-75447a888ca8
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: TIMESTAMP_TZ(9)
        description: ""
        name: VALID_STARTING_AT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 10347efb-f263-4bbc-bd5d-52b07b44131b
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 78b665bb-aa79-42f7-9c25-a3eab377ad2f
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: TICKET_CURRENT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f5f39889-fe33-48e9-85a5-9d372bcd8449
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 295bfff6-62eb-4951-9c23-5462b4887aac
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: METRIC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 28351711-110e-4285-b7af-c02d573f0366
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e767651a-4734-415b-89d3-8c556724f198
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: LATEST_SLA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d39fa091-00d7-42a4-841b-c66278b62c36
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 69f07738-2c9e-49a1-ae20-78de3590a6df
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: SLA_APPLIED_AT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1277ade2-be8b-42b1-8a00-5c7a72694bbb
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f9e89dab-8378-432d-a467-918a8a9dcec1
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: TARGET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3e4afedd-11e6-4eb6-ac8f-2a57e06b446e
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3700cb12-7f81-42c0-a529-310993ecd2af
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: IN_BUSINESS_HOURS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 94c7458c-31e3-40cb-847b-e51cb2bb5efb
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 787f65eb-ac6b-45c3-8472-a2f669cad498
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: SLA_POLICY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d4ed8545-9eee-4093-b932-90e0ebd3d610
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5bb4d491-1b7b-4cee-9b1a-79863e37411d
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: SCHEDULE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 20593080-8f92-4709-81f8-9a6e024ca635
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 439def97-ef3f-49f5-bf3c-829cf9d99e6b
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: START_TIME_IN_MINUTES_FROM_WEEK
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 882a1d24-301a-49f3-9109-9895f19601f3
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41d0d8f6-8c3b-43ed-a4cd-e8f9e47f33bd
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: TOTAL_SCHEDULE_WEEKLY_BUSINESS_MINUTES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9fd1d9d9-a07f-4509-af77-d67add497735
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 06866dc9-d061-40b6-9620-af9d3c2b6724
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: START_WEEK_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 84490575-e19f-4d96-a1a1-d55ac0796572
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ebc3a5be-72b5-4109-a76d-a8bd170906c8
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: FIRST_REPLY_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3bb92c8e-8079-497e-b2d7-f82ca1d01abb
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2b3b5cef-85c5-40b9-97da-35268edc6e8f
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: FIRST_SOLVED_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 12f6ae4b-8e80-488c-99db-571c3b051386
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c0d8d8d7-4331-470c-bf89-16a5180a407d
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: WEEK_INDEX
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f3ec17c1-c6ce-4c7d-a699-fa393f19eeed
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9f7996ec-d551-432d-8180-2ea0d52ef278
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: WEEK_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e7f3b976-6b47-460a-b6c3-d632e769d666
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3966eaef-abf1-46a3-a89c-ae6db1410972
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: TICKET_WEEK_START_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dce71a44-4894-4943-9bd2-7d9d300f165b
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8f503ffd-f1d9-4eb1-95e4-4a43502ca64c
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        description: ""
        name: TICKET_WEEK_END_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8fff559f-dcf4-4b53-bc29-056c0faaf856
                stepCounter: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: e777d25c-60b7-458d-a74f-6291fc3585a0
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        defaultValue: ""
        description: ""
        name: SCHEDULE_START_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: V_INT_SCHEDULE_SPINE.start_time_utc
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 78600115-6e55-4a11-a6a9-ce09b6a0ad32
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        defaultValue: ""
        description: ""
        name: SCHEDULE_END_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: V_INT_SCHEDULE_SPINE.end_time_utc
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 22777722-422d-4d69-a1ae-b12e88b5ef35
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        defaultValue: ""
        description: ""
        name: LAPSED_BUSINESS_MINUTES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: (V_INT_SCHEDULE_SPINE.end_time_utc - greatest(ticket_week_start_time,V_INT_SCHEDULE_SPINE.start_time_utc))
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 4eb2c768-3e4c-4615-b2f1-509927a99548
          stepCounter: dc76a1bd-4962-4cc7-b286-dbce093916de
        config: {}
        dataType: ""
        defaultValue: ""
        description: ""
        name: SUM_LAPSED_BUSINESS_MINUTES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              sum(V_INT_SCHEDULE_SPINE.end_time_utc - greatest(ticket_week_start_time,V_INT_SCHEDULE_SPINE.start_time_utc)) over 
                    (partition by ticket_id, metric, sla_applied_at 
                      order by week_number, V_INT_SCHEDULE_SPINE.start_time_utc
                      rows between unbounded preceding and current row) 
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          V_INT_SCHEDULE_SPINE: 211f47e4-699c-447c-a76d-3d6fd51428c1
          V_WEEKLY_PERIODS_REPLY: b2026c0a-f98d-4bbb-a80d-651dec7df4b5
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: V_INT_SCHEDULE_SPINE
          - locationName: TARGET
            nodeName: V_WEEKLY_PERIODS_REPLY
        join:
          joinCondition: |+
            FROM {{ ref('TARGET', 'V_WEEKLY_PERIODS_REPLY') }} "V_WEEKLY_PERIODS_REPLY"
            JOIN {{ ref('TARGET', 'V_INT_SCHEDULE_SPINE') }} "V_INT_SCHEDULE_SPINE"
             on ticket_week_start_time <= V_INT_SCHEDULE_SPINE.end_time_utc 
                and ticket_week_end_time >= V_INT_SCHEDULE_SPINE.start_time_utc
                and V_WEEKLY_PERIODS_REPLY.schedule_id = V_INT_SCHEDULE_SPINE.schedule_id
                and cast (DATEADD(
                minute, 
                (week_number * (7 * 24 * 60)) + ticket_week_end_time, 
                start_week_date
            ) as date) > cast(V_INT_SCHEDULE_SPINE.valid_from as date)
                and cast (DATEADD(
                minute, 
                (week_number * (7 * 24 * 60)) + ticket_week_start_time, 
                start_week_date
            ) as date) < cast(V_INT_SCHEDULE_SPINE.valid_until as date)




        name: V_INTERCEPTED_PERIODS_REPLY
        noLinkRefs: []
  name: V_INTERCEPTED_PERIODS_REPLY
  overrideSQL: false
  schema: ""
  sqlType: Base:::188
  type: sql
  version: 1
type: Node
